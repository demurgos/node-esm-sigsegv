"use strict";
/**
 * @module kryo/writers/json-stream
 */
Object.defineProperty(exports, "__esModule", { value: true });
class JsonStreamWriter {
    constructor(stream) {
        this.stream = stream;
    }
    writeAny(value) {
        return this.stream.write(JSON.stringify(value));
    }
    writeBoolean(value) {
        return this.stream.write(value ? "true" : "false");
    }
    writeBytes(value) {
        const result = new Array(value.length);
        const len = value.length;
        for (let i = 0; i < len; i++) {
            result[i] = (value[i] < 16 ? "0" : "") + value[i].toString(16);
        }
        return this.writeString(result.join(""));
    }
    writeDocument(keys, handler) {
        let shouldContinue = true;
        shouldContinue = this.stream.write("{") && shouldContinue;
        let first = true;
        for (const key of keys) {
            if (!first) {
                shouldContinue = this.stream.write(",") && shouldContinue;
            }
            shouldContinue = this.writeString(key) && shouldContinue;
            shouldContinue = this.stream.write(":") && shouldContinue;
            shouldContinue = handler(key, this) && shouldContinue;
            first = false;
        }
        return this.stream.write("}") && shouldContinue;
    }
    writeFloat64(value) {
        if (isNaN(value)) {
            return this.writeString("NaN");
        }
        else if (value === Infinity) {
            return this.writeString("+Infinity");
        }
        else if (value === -Infinity) {
            return this.writeString("-Infinity");
        }
        else if (Object.is(value, -0)) {
            return this.writeString("-0");
        }
        return this.stream.write(value.toString(10));
    }
    writeDate(value) {
        return this.writeString(value.toISOString());
    }
    writeList(size, handler) {
        let shouldContinue = true;
        shouldContinue = this.stream.write("[") && shouldContinue;
        for (let index = 0; index < size; index++) {
            if (index > 0) {
                shouldContinue = this.stream.write(",") && shouldContinue;
            }
            shouldContinue = handler(index, this) && shouldContinue;
        }
        return this.stream.write("]") && shouldContinue;
    }
    writeNull() {
        return this.stream.write("null");
    }
    writeMap(size, keyHandler, valueHandler) {
        let shouldContinue = true;
        shouldContinue = this.stream.write("{") && shouldContinue;
        for (let index = 0; index < size; index++) {
            if (index > 0) {
                shouldContinue = this.stream.write(",") && shouldContinue;
            }
            const chunks = [];
            const subStream = new JsonStreamWriter({
                write(chunk) {
                    chunks.push(chunk);
                    return shouldContinue;
                },
            });
            shouldContinue = keyHandler(index, subStream) && shouldContinue;
            shouldContinue = this.writeString(chunks.join("")) && shouldContinue;
            shouldContinue = this.stream.write(":") && shouldContinue;
            shouldContinue = valueHandler(index, this) && shouldContinue;
        }
        return this.stream.write("}") && shouldContinue;
    }
    writeString(value) {
        return this.stream.write(JSON.stringify(value));
    }
}
exports.JsonStreamWriter = JsonStreamWriter;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvd3JpdGVycy9qc29uLXN0cmVhbS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7O0dBRUc7O0FBY0gsTUFBYSxnQkFBZ0I7SUFHM0IsWUFBWSxNQUFzQjtRQUNoQyxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztJQUN2QixDQUFDO0lBRUQsUUFBUSxDQUFDLEtBQVU7UUFDakIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDbEQsQ0FBQztJQUVELFlBQVksQ0FBQyxLQUFjO1FBQ3pCLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3JELENBQUM7SUFFRCxVQUFVLENBQUMsS0FBaUI7UUFDMUIsTUFBTSxNQUFNLEdBQWEsSUFBSSxLQUFLLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2pELE1BQU0sR0FBRyxHQUFXLEtBQUssQ0FBQyxNQUFNLENBQUM7UUFDakMsS0FBSyxJQUFJLENBQUMsR0FBVyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUNwQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7U0FDaEU7UUFDRCxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQzNDLENBQUM7SUFFRCxhQUFhLENBQ1gsSUFBaUIsRUFDakIsT0FBMEQ7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bS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQG1vZHVsZSBrcnlvL3dyaXRlcnMvanNvbi1zdHJlYW1cbiAqL1xuXG5pbXBvcnQgeyBXcml0ZXIgfSBmcm9tIFwiLi4vY29yZVwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIFdyaXRhYmxlU3RyZWFtIHtcbiAgLyoqXG4gICAqIFdyaXRlIGEgc3RyaW5nIHRvIHRoZSBzdHJlYW0uXG4gICAqXG4gICAqIEBwYXJhbSBjaHVuayBDaHVuayBvZiBVQ1MyIGNvZGUgdW5pdHMsIHRoZXkgbXVzdCBiZSBlbmNvZGVkIGFzIFVURi04LlxuICAgKiBAcmV0dXJuIEJvb2xlYW4gaW5kaWNhdGluZyB0aGF0IHRoZSBzdHJlYW0gY2FuIGFjY2VwdCBtb3JlIGRhdGEuXG4gICAqL1xuICB3cml0ZShjaHVuazogc3RyaW5nKTogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGNsYXNzIEpzb25TdHJlYW1Xcml0ZXIgaW1wbGVtZW50cyBXcml0ZXI8Ym9vbGVhbj4ge1xuICBwcml2YXRlIHJlYWRvbmx5IHN0cmVhbTogV3JpdGFibGVTdHJlYW07XG5cbiAgY29uc3RydWN0b3Ioc3RyZWFtOiBXcml0YWJsZVN0cmVhbSkge1xuICAgIHRoaXMuc3RyZWFtID0gc3RyZWFtO1xuICB9XG5cbiAgd3JpdGVBbnkodmFsdWU6IGFueSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnN0cmVhbS53cml0ZShKU09OLnN0cmluZ2lmeSh2YWx1ZSkpO1xuICB9XG5cbiAgd3JpdGVCb29sZWFuKHZhbHVlOiBib29sZWFuKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuc3RyZWFtLndyaXRlKHZhbHVlID8gXCJ0cnVlXCIgOiBcImZhbHNlXCIpO1xuICB9XG5cbiAgd3JpdGVCeXRlcyh2YWx1ZTogVWludDhBcnJheSk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHJlc3VsdDogc3RyaW5nW10gPSBuZXcgQXJyYXkodmFsdWUubGVuZ3RoKTtcbiAgICBjb25zdCBsZW46IG51bWJlciA9IHZhbHVlLmxlbmd0aDtcbiAgICBmb3IgKGxldCBpOiBudW1iZXIgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIHJlc3VsdFtpXSA9ICh2YWx1ZVtpXSA8IDE2ID8gXCIwXCIgOiBcIlwiKSArIHZhbHVlW2ldLnRvU3RyaW5nKDE2KTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMud3JpdGVTdHJpbmcocmVzdWx0LmpvaW4oXCJcIikpO1xuICB9XG5cbiAgd3JpdGVEb2N1bWVudDxLIGV4dGVuZHMgc3RyaW5nPihcbiAgICBrZXlzOiBJdGVyYWJsZTxLPixcbiAgICBoYW5kbGVyOiAoa2V5OiBLLCBmaWVsZFdyaXRlcjogV3JpdGVyPGJvb2xlYW4+KSA9PiBib29sZWFuLFxuICApOiBib29sZWFuIHtcbiAgICBsZXQgc2hvdWxkQ29udGludWU6IGJvb2xlYW4gPSB0cnVlO1xuICAgIHNob3VsZENvbnRpbnVlID0gdGhpcy5zdHJlYW0ud3JpdGUoXCJ7XCIpICYmIHNob3VsZENvbnRpbnVlO1xuICAgIGxldCBmaXJzdDogYm9vbGVhbiA9IHRydWU7XG4gICAgZm9yIChjb25zdCBrZXkgb2Yga2V5cykge1xuICAgICAgaWYgKCFmaXJzdCkge1xuICAgICAgICBzaG91bGRDb250aW51ZSA9IHRoaXMuc3RyZWFtLndyaXRlKFwiLFwiKSAmJiBzaG91bGRDb250aW51ZTtcbiAgICAgIH1cbiAgICAgIHNob3VsZENvbnRpbnVlID0gdGhpcy53cml0ZVN0cmluZyhrZXkpICYmIHNob3VsZENvbnRpbnVlO1xuICAgICAgc2hvdWxkQ29udGludWUgPSB0aGlzLnN0cmVhbS53cml0ZShcIjpcIikgJiYgc2hvdWxkQ29udGludWU7XG4gICAgICBzaG91bGRDb250aW51ZSA9IGhhbmRsZXIoa2V5LCB0aGlzKSAmJiBzaG91bGRDb250aW51ZTtcbiAgICAgIGZpcnN0ID0gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnN0cmVhbS53cml0ZShcIn1cIikgJiYgc2hvdWxkQ29udGludWU7XG4gIH1cblxuICB3cml0ZUZsb2F0NjQodmFsdWU6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIGlmIChpc05hTih2YWx1ZSkpIHtcbiAgICAgIHJldHVybiB0aGlzLndyaXRlU3RyaW5nKFwiTmFOXCIpO1xuICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IEluZmluaXR5KSB7XG4gICAgICByZXR1cm4gdGhpcy53cml0ZVN0cmluZyhcIitJbmZpbml0eVwiKTtcbiAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAtSW5maW5pdHkpIHtcbiAgICAgIHJldHVybiB0aGlzLndyaXRlU3RyaW5nKFwiLUluZmluaXR5XCIpO1xuICAgIH0gZWxzZSBpZiAoT2JqZWN0LmlzKHZhbHVlLCAtMCkpIHtcbiAgICAgIHJldHVybiB0aGlzLndyaXRlU3RyaW5nKFwiLTBcIik7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnN0cmVhbS53cml0ZSh2YWx1ZS50b1N0cmluZygxMCkpO1xuICB9XG5cbiAgd3JpdGVEYXRlKHZhbHVlOiBEYXRlKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMud3JpdGVTdHJpbmcodmFsdWUudG9JU09TdHJpbmcoKSk7XG4gIH1cblxuICB3cml0ZUxpc3Qoc2l6ZTogbnVtYmVyLCBoYW5kbGVyOiAoaW5kZXg6IG51bWJlciwgaXRlbVdyaXRlcjogV3JpdGVyPGJvb2xlYW4+KSA9PiBib29sZWFuKTogYm9vbGVhbiB7XG4gICAgbGV0IHNob3VsZENvbnRpbnVlOiBib29sZWFuID0gdHJ1ZTtcbiAgICBzaG91bGRDb250aW51ZSA9IHRoaXMuc3RyZWFtLndyaXRlKFwiW1wiKSAmJiBzaG91bGRDb250aW51ZTtcbiAgICBmb3IgKGxldCBpbmRleDogbnVtYmVyID0gMDsgaW5kZXggPCBzaXplOyBpbmRleCsrKSB7XG4gICAgICBpZiAoaW5kZXggPiAwKSB7XG4gICAgICAgIHNob3VsZENvbnRpbnVlID0gdGhpcy5zdHJlYW0ud3JpdGUoXCIsXCIpICYmIHNob3VsZENvbnRpbnVlO1xuICAgICAgfVxuICAgICAgc2hvdWxkQ29udGludWUgPSBoYW5kbGVyKGluZGV4LCB0aGlzKSAmJiBzaG91bGRDb250aW51ZTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuc3RyZWFtLndyaXRlKFwiXVwiKSAmJiBzaG91bGRDb250aW51ZTtcbiAgfVxuXG4gIHdyaXRlTnVsbCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5zdHJlYW0ud3JpdGUoXCJudWxsXCIpO1xuICB9XG5cbiAgd3JpdGVNYXAoXG4gICAgc2l6ZTogbnVtYmVyLFxuICAgIGtleUhhbmRsZXI6IChpbmRleDogbnVtYmVyLCBtYXBLZXlXcml0ZXI6IFdyaXRlcjxib29sZWFuPikgPT4gYm9vbGVhbixcbiAgICB2YWx1ZUhhbmRsZXI6IChpbmRleDogbnVtYmVyLCBtYXBWYWx1ZVdyaXRlcjogV3JpdGVyPGJvb2xlYW4+KSA9PiBib29sZWFuLFxuICApOiBib29sZWFuIHtcbiAgICBsZXQgc2hvdWxkQ29udGludWU6IGJvb2xlYW4gPSB0cnVlO1xuICAgIHNob3VsZENvbnRpbnVlID0gdGhpcy5zdHJlYW0ud3JpdGUoXCJ7XCIpICYmIHNob3VsZENvbnRpbnVlO1xuICAgIGZvciAobGV0IGluZGV4OiBudW1iZXIgPSAwOyBpbmRleCA8IHNpemU7IGluZGV4KyspIHtcbiAgICAgIGlmIChpbmRleCA+IDApIHtcbiAgICAgICAgc2hvdWxkQ29udGludWUgPSB0aGlzLnN0cmVhbS53cml0ZShcIixcIikgJiYgc2hvdWxkQ29udGludWU7XG4gICAgICB9XG4gICAgICBjb25zdCBjaHVua3M6IHN0cmluZ1tdID0gW107XG4gICAgICBjb25zdCBzdWJTdHJlYW06IEpzb25TdHJlYW1Xcml0ZXIgPSBuZXcgSnNvblN0cmVhbVdyaXRlcih7XG4gICAgICAgIHdyaXRlKGNodW5rOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgICBjaHVua3MucHVzaChjaHVuayk7XG4gICAgICAgICAgcmV0dXJuIHNob3VsZENvbnRpbnVlO1xuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgICBzaG91bGRDb250aW51ZSA9IGtleUhhbmRsZXIoaW5kZXgsIHN1YlN0cmVhbSkgJiYgc2hvdWxkQ29udGludWU7XG4gICAgICBzaG91bGRDb250aW51ZSA9IHRoaXMud3JpdGVTdHJpbmcoY2h1bmtzLmpvaW4oXCJcIikpICYmIHNob3VsZENvbnRpbnVlO1xuICAgICAgc2hvdWxkQ29udGludWUgPSB0aGlzLnN0cmVhbS53cml0ZShcIjpcIikgJiYgc2hvdWxkQ29udGludWU7XG4gICAgICBzaG91bGRDb250aW51ZSA9IHZhbHVlSGFuZGxlcihpbmRleCwgdGhpcykgJiYgc2hvdWxkQ29udGludWU7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnN0cmVhbS53cml0ZShcIn1cIikgJiYgc2hvdWxkQ29udGludWU7XG4gIH1cblxuICB3cml0ZVN0cmluZyh2YWx1ZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuc3RyZWFtLndyaXRlKEpTT04uc3RyaW5naWZ5KHZhbHVlKSk7XG4gIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
