/**
 * @module kryo/writers/json-stream
 */
export class JsonStreamWriter {
    constructor(stream) {
        this.stream = stream;
    }
    writeAny(value) {
        return this.stream.write(JSON.stringify(value));
    }
    writeBoolean(value) {
        return this.stream.write(value ? "true" : "false");
    }
    writeBytes(value) {
        const result = new Array(value.length);
        const len = value.length;
        for (let i = 0; i < len; i++) {
            result[i] = (value[i] < 16 ? "0" : "") + value[i].toString(16);
        }
        return this.writeString(result.join(""));
    }
    writeDocument(keys, handler) {
        let shouldContinue = true;
        shouldContinue = this.stream.write("{") && shouldContinue;
        let first = true;
        for (const key of keys) {
            if (!first) {
                shouldContinue = this.stream.write(",") && shouldContinue;
            }
            shouldContinue = this.writeString(key) && shouldContinue;
            shouldContinue = this.stream.write(":") && shouldContinue;
            shouldContinue = handler(key, this) && shouldContinue;
            first = false;
        }
        return this.stream.write("}") && shouldContinue;
    }
    writeFloat64(value) {
        if (isNaN(value)) {
            return this.writeString("NaN");
        }
        else if (value === Infinity) {
            return this.writeString("+Infinity");
        }
        else if (value === -Infinity) {
            return this.writeString("-Infinity");
        }
        else if (Object.is(value, -0)) {
            return this.writeString("-0");
        }
        return this.stream.write(value.toString(10));
    }
    writeDate(value) {
        return this.writeString(value.toISOString());
    }
    writeList(size, handler) {
        let shouldContinue = true;
        shouldContinue = this.stream.write("[") && shouldContinue;
        for (let index = 0; index < size; index++) {
            if (index > 0) {
                shouldContinue = this.stream.write(",") && shouldContinue;
            }
            shouldContinue = handler(index, this) && shouldContinue;
        }
        return this.stream.write("]") && shouldContinue;
    }
    writeNull() {
        return this.stream.write("null");
    }
    writeMap(size, keyHandler, valueHandler) {
        let shouldContinue = true;
        shouldContinue = this.stream.write("{") && shouldContinue;
        for (let index = 0; index < size; index++) {
            if (index > 0) {
                shouldContinue = this.stream.write(",") && shouldContinue;
            }
            const chunks = [];
            const subStream = new JsonStreamWriter({
                write(chunk) {
                    chunks.push(chunk);
                    return shouldContinue;
                },
            });
            shouldContinue = keyHandler(index, subStream) && shouldContinue;
            shouldContinue = this.writeString(chunks.join("")) && shouldContinue;
            shouldContinue = this.stream.write(":") && shouldContinue;
            shouldContinue = valueHandler(index, this) && shouldContinue;
        }
        return this.stream.write("}") && shouldContinue;
    }
    writeString(value) {
        return this.stream.write(JSON.stringify(value));
    }
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvd3JpdGVycy9qc29uLXN0cmVhbS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7R0FFRztBQWNILE1BQU0sT0FBTyxnQkFBZ0I7SUFHM0IsWUFBWSxNQUFzQjtRQUNoQyxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztJQUN2QixDQUFDO0lBRUQsUUFBUSxDQUFDLEtBQVU7UUFDakIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDbEQsQ0FBQztJQUVELFlBQVksQ0FBQyxLQUFjO1FBQ3pCLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3JELENBQUM7SUFFRCxVQUFVLENBQUMsS0FBaUI7UUFDMUIsTUFBTSxNQUFNLEdBQWEsSUFBSSxLQUFLLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2pELE1BQU0sR0FBRyxHQUFXLEtBQUssQ0FBQyxNQUFNLENBQUM7UUFDakMsS0FBSyxJQUFJLENBQUMsR0FBVyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUNwQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7U0FDaEU7UUFDRCxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQzNDLENBQUM7SUFFRCxhQUFhLENBQ1gsSUFBaUIsRUFDakIsT0FB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cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAbW9kdWxlIGtyeW8vd3JpdGVycy9qc29uLXN0cmVhbVxuICovXG5cbmltcG9ydCB7IFdyaXRlciB9IGZyb20gXCIuLi9jb3JlXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgV3JpdGFibGVTdHJlYW0ge1xuICAvKipcbiAgICogV3JpdGUgYSBzdHJpbmcgdG8gdGhlIHN0cmVhbS5cbiAgICpcbiAgICogQHBhcmFtIGNodW5rIENodW5rIG9mIFVDUzIgY29kZSB1bml0cywgdGhleSBtdXN0IGJlIGVuY29kZWQgYXMgVVRGLTguXG4gICAqIEByZXR1cm4gQm9vbGVhbiBpbmRpY2F0aW5nIHRoYXQgdGhlIHN0cmVhbSBjYW4gYWNjZXB0IG1vcmUgZGF0YS5cbiAgICovXG4gIHdyaXRlKGNodW5rOiBzdHJpbmcpOiBib29sZWFuO1xufVxuXG5leHBvcnQgY2xhc3MgSnNvblN0cmVhbVdyaXRlciBpbXBsZW1lbnRzIFdyaXRlcjxib29sZWFuPiB7XG4gIHByaXZhdGUgcmVhZG9ubHkgc3RyZWFtOiBXcml0YWJsZVN0cmVhbTtcblxuICBjb25zdHJ1Y3RvcihzdHJlYW06IFdyaXRhYmxlU3RyZWFtKSB7XG4gICAgdGhpcy5zdHJlYW0gPSBzdHJlYW07XG4gIH1cblxuICB3cml0ZUFueSh2YWx1ZTogYW55KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuc3RyZWFtLndyaXRlKEpTT04uc3RyaW5naWZ5KHZhbHVlKSk7XG4gIH1cblxuICB3cml0ZUJvb2xlYW4odmFsdWU6IGJvb2xlYW4pOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5zdHJlYW0ud3JpdGUodmFsdWUgPyBcInRydWVcIiA6IFwiZmFsc2VcIik7XG4gIH1cblxuICB3cml0ZUJ5dGVzKHZhbHVlOiBVaW50OEFycmF5KTogYm9vbGVhbiB7XG4gICAgY29uc3QgcmVzdWx0OiBzdHJpbmdbXSA9IG5ldyBBcnJheSh2YWx1ZS5sZW5ndGgpO1xuICAgIGNvbnN0IGxlbjogbnVtYmVyID0gdmFsdWUubGVuZ3RoO1xuICAgIGZvciAobGV0IGk6IG51bWJlciA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgcmVzdWx0W2ldID0gKHZhbHVlW2ldIDwgMTYgPyBcIjBcIiA6IFwiXCIpICsgdmFsdWVbaV0udG9TdHJpbmcoMTYpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy53cml0ZVN0cmluZyhyZXN1bHQuam9pbihcIlwiKSk7XG4gIH1cblxuICB3cml0ZURvY3VtZW50PEsgZXh0ZW5kcyBzdHJpbmc+KFxuICAgIGtleXM6IEl0ZXJhYmxlPEs+LFxuICAgIGhhbmRsZXI6IChrZXk6IEssIGZpZWxkV3JpdGVyOiBXcml0ZXI8Ym9vbGVhbj4pID0+IGJvb2xlYW4sXG4gICk6IGJvb2xlYW4ge1xuICAgIGxldCBzaG91bGRDb250aW51ZTogYm9vbGVhbiA9IHRydWU7XG4gICAgc2hvdWxkQ29udGludWUgPSB0aGlzLnN0cmVhbS53cml0ZShcIntcIikgJiYgc2hvdWxkQ29udGludWU7XG4gICAgbGV0IGZpcnN0OiBib29sZWFuID0gdHJ1ZTtcbiAgICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzKSB7XG4gICAgICBpZiAoIWZpcnN0KSB7XG4gICAgICAgIHNob3VsZENvbnRpbnVlID0gdGhpcy5zdHJlYW0ud3JpdGUoXCIsXCIpICYmIHNob3VsZENvbnRpbnVlO1xuICAgICAgfVxuICAgICAgc2hvdWxkQ29udGludWUgPSB0aGlzLndyaXRlU3RyaW5nKGtleSkgJiYgc2hvdWxkQ29udGludWU7XG4gICAgICBzaG91bGRDb250aW51ZSA9IHRoaXMuc3RyZWFtLndyaXRlKFwiOlwiKSAmJiBzaG91bGRDb250aW51ZTtcbiAgICAgIHNob3VsZENvbnRpbnVlID0gaGFuZGxlcihrZXksIHRoaXMpICYmIHNob3VsZENvbnRpbnVlO1xuICAgICAgZmlyc3QgPSBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuc3RyZWFtLndyaXRlKFwifVwiKSAmJiBzaG91bGRDb250aW51ZTtcbiAgfVxuXG4gIHdyaXRlRmxvYXQ2NCh2YWx1ZTogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgaWYgKGlzTmFOKHZhbHVlKSkge1xuICAgICAgcmV0dXJuIHRoaXMud3JpdGVTdHJpbmcoXCJOYU5cIik7XG4gICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gSW5maW5pdHkpIHtcbiAgICAgIHJldHVybiB0aGlzLndyaXRlU3RyaW5nKFwiK0luZmluaXR5XCIpO1xuICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IC1JbmZpbml0eSkge1xuICAgICAgcmV0dXJuIHRoaXMud3JpdGVTdHJpbmcoXCItSW5maW5pdHlcIik7XG4gICAgfSBlbHNlIGlmIChPYmplY3QuaXModmFsdWUsIC0wKSkge1xuICAgICAgcmV0dXJuIHRoaXMud3JpdGVTdHJpbmcoXCItMFwiKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuc3RyZWFtLndyaXRlKHZhbHVlLnRvU3RyaW5nKDEwKSk7XG4gIH1cblxuICB3cml0ZURhdGUodmFsdWU6IERhdGUpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy53cml0ZVN0cmluZyh2YWx1ZS50b0lTT1N0cmluZygpKTtcbiAgfVxuXG4gIHdyaXRlTGlzdChzaXplOiBudW1iZXIsIGhhbmRsZXI6IChpbmRleDogbnVtYmVyLCBpdGVtV3JpdGVyOiBXcml0ZXI8Ym9vbGVhbj4pID0+IGJvb2xlYW4pOiBib29sZWFuIHtcbiAgICBsZXQgc2hvdWxkQ29udGludWU6IGJvb2xlYW4gPSB0cnVlO1xuICAgIHNob3VsZENvbnRpbnVlID0gdGhpcy5zdHJlYW0ud3JpdGUoXCJbXCIpICYmIHNob3VsZENvbnRpbnVlO1xuICAgIGZvciAobGV0IGluZGV4OiBudW1iZXIgPSAwOyBpbmRleCA8IHNpemU7IGluZGV4KyspIHtcbiAgICAgIGlmIChpbmRleCA+IDApIHtcbiAgICAgICAgc2hvdWxkQ29udGludWUgPSB0aGlzLnN0cmVhbS53cml0ZShcIixcIikgJiYgc2hvdWxkQ29udGludWU7XG4gICAgICB9XG4gICAgICBzaG91bGRDb250aW51ZSA9IGhhbmRsZXIoaW5kZXgsIHRoaXMpICYmIHNob3VsZENvbnRpbnVlO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5zdHJlYW0ud3JpdGUoXCJdXCIpICYmIHNob3VsZENvbnRpbnVlO1xuICB9XG5cbiAgd3JpdGVOdWxsKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnN0cmVhbS53cml0ZShcIm51bGxcIik7XG4gIH1cblxuICB3cml0ZU1hcChcbiAgICBzaXplOiBudW1iZXIsXG4gICAga2V5SGFuZGxlcjogKGluZGV4OiBudW1iZXIsIG1hcEtleVdyaXRlcjogV3JpdGVyPGJvb2xlYW4+KSA9PiBib29sZWFuLFxuICAgIHZhbHVlSGFuZGxlcjogKGluZGV4OiBudW1iZXIsIG1hcFZhbHVlV3JpdGVyOiBXcml0ZXI8Ym9vbGVhbj4pID0+IGJvb2xlYW4sXG4gICk6IGJvb2xlYW4ge1xuICAgIGxldCBzaG91bGRDb250aW51ZTogYm9vbGVhbiA9IHRydWU7XG4gICAgc2hvdWxkQ29udGludWUgPSB0aGlzLnN0cmVhbS53cml0ZShcIntcIikgJiYgc2hvdWxkQ29udGludWU7XG4gICAgZm9yIChsZXQgaW5kZXg6IG51bWJlciA9IDA7IGluZGV4IDwgc2l6ZTsgaW5kZXgrKykge1xuICAgICAgaWYgKGluZGV4ID4gMCkge1xuICAgICAgICBzaG91bGRDb250aW51ZSA9IHRoaXMuc3RyZWFtLndyaXRlKFwiLFwiKSAmJiBzaG91bGRDb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGNodW5rczogc3RyaW5nW10gPSBbXTtcbiAgICAgIGNvbnN0IHN1YlN0cmVhbTogSnNvblN0cmVhbVdyaXRlciA9IG5ldyBKc29uU3RyZWFtV3JpdGVyKHtcbiAgICAgICAgd3JpdGUoY2h1bms6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICAgIGNodW5rcy5wdXNoKGNodW5rKTtcbiAgICAgICAgICByZXR1cm4gc2hvdWxkQ29udGludWU7XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIHNob3VsZENvbnRpbnVlID0ga2V5SGFuZGxlcihpbmRleCwgc3ViU3RyZWFtKSAmJiBzaG91bGRDb250aW51ZTtcbiAgICAgIHNob3VsZENvbnRpbnVlID0gdGhpcy53cml0ZVN0cmluZyhjaHVua3Muam9pbihcIlwiKSkgJiYgc2hvdWxkQ29udGludWU7XG4gICAgICBzaG91bGRDb250aW51ZSA9IHRoaXMuc3RyZWFtLndyaXRlKFwiOlwiKSAmJiBzaG91bGRDb250aW51ZTtcbiAgICAgIHNob3VsZENvbnRpbnVlID0gdmFsdWVIYW5kbGVyKGluZGV4LCB0aGlzKSAmJiBzaG91bGRDb250aW51ZTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuc3RyZWFtLndyaXRlKFwifVwiKSAmJiBzaG91bGRDb250aW51ZTtcbiAgfVxuXG4gIHdyaXRlU3RyaW5nKHZhbHVlOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5zdHJlYW0ud3JpdGUoSlNPTi5zdHJpbmdpZnkodmFsdWUpKTtcbiAgfVxufVxuIl0sInNvdXJjZVJvb3QiOiIuLi8uLiJ9
