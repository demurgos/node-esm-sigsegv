import { Incident } from "incident";
import { lazyProperties } from "../_helpers/lazy-properties";
import { createLazyOptionsError } from "../errors/lazy-options";
import { testError } from "../test-error";
export const name = "literal";
/**
 * You may need to explicitly write the type or inference won't pick it.
 * For example, in the case of enum values, inference will pick the type of the enum instead of
 * the specific property you pass.
 *
 * @see https://github.com/Microsoft/TypeScript/issues/10195
 */
// tslint:disable-next-line:variable-name
export const LiteralType = class {
    constructor(options) {
        this.name = name;
        this._options = options;
        if (typeof options !== "function") {
            this._applyOptions();
        }
        else {
            lazyProperties(this, this._applyOptions, ["type", "value"]);
        }
    }
    read(reader, raw) {
        if (this.type.read === undefined) {
            throw new Incident("NotReadable", { type: this });
        }
        return reader.trustInput ? this.clone(this.value) : this.type.read(reader, raw);
    }
    write(writer, value) {
        if (this.type.write === undefined) {
            throw new Incident("NotWritable", { type: this });
        }
        return this.type.write(writer, value);
    }
    testError(val) {
        const error = testError(this.type, val);
        if (error !== undefined) {
            return error;
        }
        if (!this.type.equals(val, this.value)) {
            return Incident("InvalidLiteral", "Invalid literal value");
        }
        return undefined;
    }
    test(value) {
        return this.type.test(value) && this.type.equals(value, this.value);
    }
    equals(val1, val2) {
        return this.type.equals(val1, val2);
    }
    clone(val) {
        return this.type.clone(val);
    }
    diff(_oldVal, _newVal) {
        return;
    }
    patch(oldVal, _diff) {
        return this.type.clone(oldVal);
    }
    reverseDiff(_diff) {
        return;
    }
    squash(_diff1, _diff2) {
        return;
    }
    _applyOptions() {
        if (this._options === undefined) {
            throw createLazyOptionsError(this);
        }
        const options = typeof this._options === "function"
            ? this._options()
            : this._options;
        const type = options.type;
        const value = options.value;
        Object.assign(this, { type, value });
    }
};

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvdHlwZXMvbGl0ZXJhbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBQ3BDLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUU3RCxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNoRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRzFDLE1BQU0sQ0FBQyxNQUFNLElBQUksR0FBUyxTQUFTLENBQUM7QUEyQnBDOzs7Ozs7R0FNRztBQUNILHlDQUF5QztBQUN6QyxNQUFNLENBQUMsTUFBTSxXQUFXLEdBQTJCO0lBT2pELFlBQVksT0FBd0M7UUFOM0MsU0FBSSxHQUFTLElBQUksQ0FBQztRQU96QixJQUFJLENBQUMsUUFBUSxHQUFHLE9BQU8sQ0FBQztRQUN4QixJQUFJLE9BQU8sT0FBTyxLQUFLLFVBQVUsRUFBRTtZQUNqQyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7U0FDdEI7YUFBTTtZQUNMLGNBQWMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO1NBQzdEO0lBQ0gsQ0FBQztJQUVELElBQUksQ0FBSSxNQUFpQixFQUFFLEdBQU07UUFDL0IsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksS0FBSyxTQUFTLEVBQUU7WUFDaEMsTUFBTSxJQUFJLFFBQVEsQ0FBQyxhQUFhLEVBQUUsRUFBQyxJQUFJLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztTQUNqRDtRQUNELE9BQU8sTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQztJQUNsRixDQUFDO0lBRUQsS0FBSyxDQUFJLE1BQWlCLEVBQUUsS0FBUztRQUNuQyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxLQUFLLFNBQVMsRUFBRTtZQUNqQyxNQUFNLElBQUksUUFBUSxDQUFDLGFBQWEsRUFBRSxFQUFDLElBQUksRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDO1NBQ2pEO1FBQ0QsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDeEMsQ0FBQztJQUVELFNBQVMsQ0FBQyxHQUFPO1FBQ2YsTUFBTSxLQUFLLEdBQXNCLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQzNELElBQUksS0FBSyxLQUFLLFNBQVMsRUFBRTtZQUN2QixPQUFPLEtBQUssQ0FBQztTQUNkO1FBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDdEMsT0FBTyxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsdUJBQXVCLENBQUMsQ0FBQztTQUM1RDtRQUNELE9BQU8sU0FBUyxDQUFDO0lBQ25CLENBQUM7SUFFRCxJQUFJLENBQUMsS0FBUztRQUNaLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN0RSxDQUFDO0lBRUQsTUFBTSxDQUFDLElBQVEsRUFBRSxJQUFRO1FBQ3ZCLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3RDLENBQUM7SUFFRCxLQUFLLENBQUMsR0FBTztRQUNYLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDOUIsQ0FBQztJQUVELElBQUksQ0FBQyxPQUFXLEVBQUUsT0FBVztRQUMzQixPQUFPO0lBQ1QsQ0FBQztJQUVELEtBQUssQ0FBQyxNQUFVLEVBQUUsS0FBZ0I7UUFDaEMsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNqQyxDQUFDO0lBRUQsV0FBVyxDQUFDLEtBQXVCO1FBQ2pDLE9BQU87SUFDVCxDQUFDO0lBRUQsTUFBTSxDQUFDLE1BQWlCLEVBQUUsTUFBaUI7UUFDekMsT0FBTztJQUNULENBQUM7SUFFTyxhQUFhO1FBQ25CLElBQUksSUFBSSxDQUFDLFFBQVEsS0FBSyxTQUFTLEVBQUU7WUFDL0IsTUFBTSxzQkFBc0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNwQztRQUNELE1BQU0sT0FBTyxHQUE4QixPQUFPLElBQUksQ0FBQyxRQUFRLEtBQUssVUFBVTtZQUM1RSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNqQixDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUVsQixNQUFNLElBQUksR0FBTSxPQUFPLENBQUMsSUFBSSxDQUFDO1FBQzdCLE1BQU0sS0FBSyxHQUFPLE9BQU8sQ0FBQyxLQUFLLENBQUM7UUFFaEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsRUFBQyxJQUFJLEVBQUUsS0FBSyxFQUFDLENBQUMsQ0FBQztJQUNyQyxDQUFDO0NBQ0YsQ0FBQyIsImZpbGUiOiJsaWIvdHlwZXMvbGl0ZXJhbC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluY2lkZW50IH0gZnJvbSBcImluY2lkZW50XCI7XG5pbXBvcnQgeyBsYXp5UHJvcGVydGllcyB9IGZyb20gXCIuLi9faGVscGVycy9sYXp5LXByb3BlcnRpZXNcIjtcbmltcG9ydCB7IElvVHlwZSwgTGF6eSwgUmVhZGVyLCBUeXBlLCBXcml0ZXIgfSBmcm9tIFwiLi4vY29yZVwiO1xuaW1wb3J0IHsgY3JlYXRlTGF6eU9wdGlvbnNFcnJvciB9IGZyb20gXCIuLi9lcnJvcnMvbGF6eS1vcHRpb25zXCI7XG5pbXBvcnQgeyB0ZXN0RXJyb3IgfSBmcm9tIFwiLi4vdGVzdC1lcnJvclwiO1xuXG5leHBvcnQgdHlwZSBOYW1lID0gXCJsaXRlcmFsXCI7XG5leHBvcnQgY29uc3QgbmFtZTogTmFtZSA9IFwibGl0ZXJhbFwiO1xuZXhwb3J0IHR5cGUgRGlmZiA9IGFueTtcblxuLyoqXG4gKiBUOiBUeXBlc2NyaXB0IHR5cGVcbiAqIEs6IEtyeW8gdHlwZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIExpdGVyYWxUeXBlT3B0aW9uczxULCBLIGV4dGVuZHMgVHlwZTxhbnk+ID0gVHlwZTxhbnk+PiB7XG4gIHR5cGU6IEs7XG4gIHZhbHVlOiBUO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIExpdGVyYWxUeXBlQ29uc3RydWN0b3Ige1xuICBuZXc8VD4ob3B0aW9uczogTGF6eTxMaXRlcmFsVHlwZU9wdGlvbnM8VCwgSW9UeXBlPGFueT4+Pik6IExpdGVyYWxJb1R5cGU8VD47XG5cbiAgbmV3PFQ+KG9wdGlvbnM6IExhenk8TGl0ZXJhbFR5cGVPcHRpb25zPFQ+Pik6IExpdGVyYWxUeXBlPFQ+O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIExpdGVyYWxUeXBlPFQsIEsgZXh0ZW5kcyBUeXBlPGFueT4gPSBUeXBlPGFueT4+IGV4dGVuZHMgVHlwZTxUPiwgTGl0ZXJhbFR5cGVPcHRpb25zPFQsIEs+IHtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBMaXRlcmFsSW9UeXBlPFQsIEsgZXh0ZW5kcyBJb1R5cGU8YW55PiA9IElvVHlwZTxhbnk+PiBleHRlbmRzIElvVHlwZTxUPiwgTGl0ZXJhbFR5cGU8VCwgSz4ge1xuICByZWFkPFI+KHJlYWRlcjogUmVhZGVyPFI+LCByYXc6IFIpOiBUO1xuXG4gIHdyaXRlPFc+KHdyaXRlcjogV3JpdGVyPFc+LCB2YWx1ZTogVCk6IFc7XG59XG5cbi8qKlxuICogWW91IG1heSBuZWVkIHRvIGV4cGxpY2l0bHkgd3JpdGUgdGhlIHR5cGUgb3IgaW5mZXJlbmNlIHdvbid0IHBpY2sgaXQuXG4gKiBGb3IgZXhhbXBsZSwgaW4gdGhlIGNhc2Ugb2YgZW51bSB2YWx1ZXMsIGluZmVyZW5jZSB3aWxsIHBpY2sgdGhlIHR5cGUgb2YgdGhlIGVudW0gaW5zdGVhZCBvZlxuICogdGhlIHNwZWNpZmljIHByb3BlcnR5IHlvdSBwYXNzLlxuICpcbiAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL01pY3Jvc29mdC9UeXBlU2NyaXB0L2lzc3Vlcy8xMDE5NVxuICovXG4vLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6dmFyaWFibGUtbmFtZVxuZXhwb3J0IGNvbnN0IExpdGVyYWxUeXBlOiBMaXRlcmFsVHlwZUNvbnN0cnVjdG9yID0gY2xhc3M8VFQsIEsgZXh0ZW5kcyBUeXBlPGFueT4gPSBUeXBlPGFueT4+IGltcGxlbWVudHMgSW9UeXBlPFRUPiB7XG4gIHJlYWRvbmx5IG5hbWU6IE5hbWUgPSBuYW1lO1xuICByZWFkb25seSB0eXBlITogSztcbiAgcmVhZG9ubHkgdmFsdWUhOiBUVDtcblxuICBwcml2YXRlIF9vcHRpb25zOiBMYXp5PExpdGVyYWxUeXBlT3B0aW9uczxUVCwgSz4+O1xuXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnM6IExhenk8TGl0ZXJhbFR5cGVPcHRpb25zPFRULCBLPj4pIHtcbiAgICB0aGlzLl9vcHRpb25zID0gb3B0aW9ucztcbiAgICBpZiAodHlwZW9mIG9wdGlvbnMgIT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgdGhpcy5fYXBwbHlPcHRpb25zKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxhenlQcm9wZXJ0aWVzKHRoaXMsIHRoaXMuX2FwcGx5T3B0aW9ucywgW1widHlwZVwiLCBcInZhbHVlXCJdKTtcbiAgICB9XG4gIH1cblxuICByZWFkPFI+KHJlYWRlcjogUmVhZGVyPFI+LCByYXc6IFIpOiBUVCB7XG4gICAgaWYgKHRoaXMudHlwZS5yZWFkID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRocm93IG5ldyBJbmNpZGVudChcIk5vdFJlYWRhYmxlXCIsIHt0eXBlOiB0aGlzfSk7XG4gICAgfVxuICAgIHJldHVybiByZWFkZXIudHJ1c3RJbnB1dCA/IHRoaXMuY2xvbmUodGhpcy52YWx1ZSkgOiB0aGlzLnR5cGUucmVhZChyZWFkZXIsIHJhdyk7XG4gIH1cblxuICB3cml0ZTxXPih3cml0ZXI6IFdyaXRlcjxXPiwgdmFsdWU6IFRUKTogVyB7XG4gICAgaWYgKHRoaXMudHlwZS53cml0ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aHJvdyBuZXcgSW5jaWRlbnQoXCJOb3RXcml0YWJsZVwiLCB7dHlwZTogdGhpc30pO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy50eXBlLndyaXRlKHdyaXRlciwgdmFsdWUpO1xuICB9XG5cbiAgdGVzdEVycm9yKHZhbDogVFQpOiBFcnJvciB8IHVuZGVmaW5lZCB7XG4gICAgY29uc3QgZXJyb3I6IEVycm9yIHwgdW5kZWZpbmVkID0gdGVzdEVycm9yKHRoaXMudHlwZSwgdmFsKTtcbiAgICBpZiAoZXJyb3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIGVycm9yO1xuICAgIH1cbiAgICBpZiAoIXRoaXMudHlwZS5lcXVhbHModmFsLCB0aGlzLnZhbHVlKSkge1xuICAgICAgcmV0dXJuIEluY2lkZW50KFwiSW52YWxpZExpdGVyYWxcIiwgXCJJbnZhbGlkIGxpdGVyYWwgdmFsdWVcIik7XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICB0ZXN0KHZhbHVlOiBUVCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnR5cGUudGVzdCh2YWx1ZSkgJiYgdGhpcy50eXBlLmVxdWFscyh2YWx1ZSwgdGhpcy52YWx1ZSk7XG4gIH1cblxuICBlcXVhbHModmFsMTogVFQsIHZhbDI6IFRUKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMudHlwZS5lcXVhbHModmFsMSwgdmFsMik7XG4gIH1cblxuICBjbG9uZSh2YWw6IFRUKTogVFQge1xuICAgIHJldHVybiB0aGlzLnR5cGUuY2xvbmUodmFsKTtcbiAgfVxuXG4gIGRpZmYoX29sZFZhbDogVFQsIF9uZXdWYWw6IFRUKTogdW5kZWZpbmVkIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBwYXRjaChvbGRWYWw6IFRULCBfZGlmZjogdW5kZWZpbmVkKTogVFQge1xuICAgIHJldHVybiB0aGlzLnR5cGUuY2xvbmUob2xkVmFsKTtcbiAgfVxuXG4gIHJldmVyc2VEaWZmKF9kaWZmOiBEaWZmIHwgdW5kZWZpbmVkKTogdW5kZWZpbmVkIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBzcXVhc2goX2RpZmYxOiB1bmRlZmluZWQsIF9kaWZmMjogdW5kZWZpbmVkKTogdW5kZWZpbmVkIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBwcml2YXRlIF9hcHBseU9wdGlvbnMoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuX29wdGlvbnMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgY3JlYXRlTGF6eU9wdGlvbnNFcnJvcih0aGlzKTtcbiAgICB9XG4gICAgY29uc3Qgb3B0aW9uczogTGl0ZXJhbFR5cGVPcHRpb25zPFRULCBLPiA9IHR5cGVvZiB0aGlzLl9vcHRpb25zID09PSBcImZ1bmN0aW9uXCJcbiAgICAgID8gdGhpcy5fb3B0aW9ucygpXG4gICAgICA6IHRoaXMuX29wdGlvbnM7XG5cbiAgICBjb25zdCB0eXBlOiBLID0gb3B0aW9ucy50eXBlO1xuICAgIGNvbnN0IHZhbHVlOiBUVCA9IG9wdGlvbnMudmFsdWU7XG5cbiAgICBPYmplY3QuYXNzaWduKHRoaXMsIHt0eXBlLCB2YWx1ZX0pO1xuICB9XG59O1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLiJ9
