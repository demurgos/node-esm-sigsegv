import bson from "bson";
import { Incident } from "incident";
import { createInvalidTypeError } from "../../lib/errors/invalid-type";
import { readVisitor } from "../../lib/readers/read-visitor";
import { CustomType } from "../../lib/types/custom";
import { runTests } from "../helpers/test";
describe("Custom", function () {
    /**
     * Represents a complex number.
     * It only deals with complex number with small unsigned integer cartesian components for
     * simplicity.
     */
    class Complex {
        constructor(real, imaginary) {
            this.real = real;
            this.imaginary = imaginary;
            Object.freeze(this);
        }
        static fromString(input) {
            const realMatch = /^(\d+)(?:\s*\+\s*\d+j)?$/.exec(input);
            const imaginaryMatch = /^(?:\d+\s*\+\s*)?(\d+)j$/.exec(input);
            if (realMatch === null && imaginaryMatch === null) {
                throw new Incident("InvalidInput", { input });
            }
            const real = realMatch !== null ? parseInt(realMatch[1], 10) : 0;
            const imaginary = imaginaryMatch !== null ? parseInt(imaginaryMatch[1], 10) : 0;
            return new Complex(real, imaginary);
        }
        toString() {
            const parts = [];
            if (this.real !== 0) {
                parts.push(this.real.toString(10));
            }
            if (this.imaginary !== 0) {
                parts.push(`${this.imaginary.toString(10)}j`);
            }
            // tslint:disable-next-line:strict-boolean-expressions
            return parts.join(" + ") || "0";
        }
    }
    const complexType = new CustomType({
        read(reader, raw) {
            return reader.readString(raw, readVisitor({
                fromString: (input) => {
                    return Complex.fromString(input);
                },
                fromFloat64: (input) => {
                    return new Complex(input, 0);
                },
            }));
        },
        write(writer, value) {
            return writer.writeString(value.toString());
        },
        testError(value) {
            if (!(value instanceof Complex)) {
                return createInvalidTypeError("Complex", value);
            }
            return undefined;
        },
        equals(value1, value2) {
            return value1.real === value2.real && value1.imaginary === value2.imaginary;
        },
        clone(value) {
            return new Complex(value.real, value.imaginary);
        },
    });
    const bsonSerializer = new bson.BSON();
    const items = [
        {
            name: "Complex {real: 0, imaginary: 0}",
            value: new Complex(0, 0),
            valid: true,
            output: {
                bson: bsonSerializer.serialize({ _: "0" }),
                json: "\"0\"",
                qs: "_=0",
            },
        },
        {
            name: "Complex {real: 1, imaginary: 0}",
            value: new Complex(1, 0),
            valid: true,
            output: {
                bson: bsonSerializer.serialize({ _: "1" }),
                json: "\"1\"",
                qs: "_=1",
            },
        },
        {
            name: "Complex {real: 0, imaginary: 2}",
            value: new Complex(0, 2),
            valid: true,
            output: {
                bson: bsonSerializer.serialize({ _: "2j" }),
                json: "\"2j\"",
                qs: "_=2j",
            },
        },
        {
            name: "Complex {real: 3, imaginary: 4}",
            value: new Complex(3, 4),
            valid: true,
            output: {
                bson: bsonSerializer.serialize({ _: "3 + 4j" }),
                json: "\"3 + 4j\"",
                qs: "_=3%20%2B%204j",
            },
        },
        { name: "\"foo\"", value: "bar", valid: false },
        { name: "0", value: 0, valid: false },
        { name: "1", value: 1, valid: false },
        { name: "\"\"", value: "", valid: false },
        { name: "\"0\"", value: "0", valid: false },
        { name: "true", value: true, valid: false },
        { name: "false", value: false, valid: false },
        { name: "Infinity", value: Infinity, valid: false },
        { name: "-Infinity", value: -Infinity, valid: false },
        { name: "new Date(\"1247-05-18T19:40:08.418Z\")", value: new Date("1247-05-18T19:40:08.418Z"), valid: false },
        { name: "NaN", value: NaN, valid: false },
        { name: "undefined", value: undefined, valid: false },
        { name: "null", value: null, valid: false },
        { name: "[]", value: [], valid: false },
        { name: "{}", value: {}, valid: false },
        { name: "/regex/", value: /regex/, valid: false },
    ];
    runTests(complexType, items);
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90ZXN0L3R5cGVzL2N1c3RvbS5zcGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sSUFBSSxNQUFNLE1BQU0sQ0FBQztBQUN4QixPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBRXBDLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUM3RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDcEQsT0FBTyxFQUFFLFFBQVEsRUFBYyxNQUFNLGlCQUFpQixDQUFDO0FBRXZELFFBQVEsQ0FBQyxRQUFRLEVBQUU7SUFDakI7Ozs7T0FJRztJQUNILE1BQU0sT0FBTztRQUlYLFlBQVksSUFBWSxFQUFFLFNBQWlCO1lBQ3pDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1lBQ2pCLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO1lBQzNCLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdEIsQ0FBQztRQUVELE1BQU0sQ0FBQyxVQUFVLENBQUMsS0FBYTtZQUM3QixNQUFNLFNBQVMsR0FBMkIsMEJBQTBCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ2pGLE1BQU0sY0FBYyxHQUEyQiwwQkFBMEIsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDdEYsSUFBSSxTQUFTLEtBQUssSUFBSSxJQUFJLGNBQWMsS0FBSyxJQUFJLEVBQUU7Z0JBQ2pELE1BQU0sSUFBSSxRQUFRLENBQUMsY0FBYyxFQUFFLEVBQUMsS0FBSyxFQUFDLENBQUMsQ0FBQzthQUM3QztZQUNELE1BQU0sSUFBSSxHQUFXLFNBQVMsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENB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QUFLLEVBQUM7S0FDaEQsQ0FBQztJQUVGLFFBQVEsQ0FBQyxXQUFXLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDL0IsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoidGVzdC90eXBlcy9jdXN0b20uc3BlYy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBic29uIGZyb20gXCJic29uXCI7XG5pbXBvcnQgeyBJbmNpZGVudCB9IGZyb20gXCJpbmNpZGVudFwiO1xuaW1wb3J0IHsgUmVhZGVyLCBXcml0ZXIgfSBmcm9tIFwiLi4vLi4vbGliL2NvcmVcIjtcbmltcG9ydCB7IGNyZWF0ZUludmFsaWRUeXBlRXJyb3IgfSBmcm9tIFwiLi4vLi4vbGliL2Vycm9ycy9pbnZhbGlkLXR5cGVcIjtcbmltcG9ydCB7IHJlYWRWaXNpdG9yIH0gZnJvbSBcIi4uLy4uL2xpYi9yZWFkZXJzL3JlYWQtdmlzaXRvclwiO1xuaW1wb3J0IHsgQ3VzdG9tVHlwZSB9IGZyb20gXCIuLi8uLi9saWIvdHlwZXMvY3VzdG9tXCI7XG5pbXBvcnQgeyBydW5UZXN0cywgVHlwZWRWYWx1ZSB9IGZyb20gXCIuLi9oZWxwZXJzL3Rlc3RcIjtcblxuZGVzY3JpYmUoXCJDdXN0b21cIiwgZnVuY3Rpb24gKCkge1xuICAvKipcbiAgICogUmVwcmVzZW50cyBhIGNvbXBsZXggbnVtYmVyLlxuICAgKiBJdCBvbmx5IGRlYWxzIHdpdGggY29tcGxleCBudW1iZXIgd2l0aCBzbWFsbCB1bnNpZ25lZCBpbnRlZ2VyIGNhcnRlc2lhbiBjb21wb25lbnRzIGZvclxuICAgKiBzaW1wbGljaXR5LlxuICAgKi9cbiAgY2xhc3MgQ29tcGxleCB7XG4gICAgcmVhZG9ubHkgcmVhbDogbnVtYmVyO1xuICAgIHJlYWRvbmx5IGltYWdpbmFyeTogbnVtYmVyO1xuXG4gICAgY29uc3RydWN0b3IocmVhbDogbnVtYmVyLCBpbWFnaW5hcnk6IG51bWJlcikge1xuICAgICAgdGhpcy5yZWFsID0gcmVhbDtcbiAgICAgIHRoaXMuaW1hZ2luYXJ5ID0gaW1hZ2luYXJ5O1xuICAgICAgT2JqZWN0LmZyZWV6ZSh0aGlzKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZnJvbVN0cmluZyhpbnB1dDogc3RyaW5nKTogQ29tcGxleCB7XG4gICAgICBjb25zdCByZWFsTWF0Y2g6IFJlZ0V4cEV4ZWNBcnJheSB8IG51bGwgPSAvXihcXGQrKSg/OlxccypcXCtcXHMqXFxkK2opPyQvLmV4ZWMoaW5wdXQpO1xuICAgICAgY29uc3QgaW1hZ2luYXJ5TWF0Y2g6IFJlZ0V4cEV4ZWNBcnJheSB8IG51bGwgPSAvXig/OlxcZCtcXHMqXFwrXFxzKik/KFxcZCspaiQvLmV4ZWMoaW5wdXQpO1xuICAgICAgaWYgKHJlYWxNYXRjaCA9PT0gbnVsbCAmJiBpbWFnaW5hcnlNYXRjaCA9PT0gbnVsbCkge1xuICAgICAgICB0aHJvdyBuZXcgSW5jaWRlbnQoXCJJbnZhbGlkSW5wdXRcIiwge2lucHV0fSk7XG4gICAgICB9XG4gICAgICBjb25zdCByZWFsOiBudW1iZXIgPSByZWFsTWF0Y2ggIT09IG51bGwgPyBwYXJzZUludChyZWFsTWF0Y2hbMV0sIDEwKSA6IDA7XG4gICAgICBjb25zdCBpbWFnaW5hcnk6IG51bWJlciA9IGltYWdpbmFyeU1hdGNoICE9PSBudWxsID8gcGFyc2VJbnQoaW1hZ2luYXJ5TWF0Y2hbMV0sIDEwKSA6IDA7XG4gICAgICByZXR1cm4gbmV3IENvbXBsZXgocmVhbCwgaW1hZ2luYXJ5KTtcbiAgICB9XG5cbiAgICB0b1N0cmluZygpOiBzdHJpbmcge1xuICAgICAgY29uc3QgcGFydHM6IHN0cmluZ1tdID0gW107XG4gICAgICBpZiAodGhpcy5yZWFsICE9PSAwKSB7XG4gICAgICAgIHBhcnRzLnB1c2godGhpcy5yZWFsLnRvU3RyaW5nKDEwKSk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5pbWFnaW5hcnkgIT09IDApIHtcbiAgICAgICAgcGFydHMucHVzaChgJHt0aGlzLmltYWdpbmFyeS50b1N0cmluZygxMCl9amApO1xuICAgICAgfVxuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnN0cmljdC1ib29sZWFuLWV4cHJlc3Npb25zXG4gICAgICByZXR1cm4gcGFydHMuam9pbihcIiArIFwiKSB8fCBcIjBcIjtcbiAgICB9XG4gIH1cblxuICBjb25zdCBjb21wbGV4VHlwZTogQ3VzdG9tVHlwZTxDb21wbGV4PiA9IG5ldyBDdXN0b21UeXBlKHtcbiAgICByZWFkPFI+KHJlYWRlcjogUmVhZGVyPFI+LCByYXc6IFIpOiBDb21wbGV4IHtcbiAgICAgIHJldHVybiByZWFkZXIucmVhZFN0cmluZyhyYXcsIHJlYWRWaXNpdG9yKHtcbiAgICAgICAgZnJvbVN0cmluZzogKGlucHV0OiBzdHJpbmcpOiBDb21wbGV4ID0+IHtcbiAgICAgICAgICByZXR1cm4gQ29tcGxleC5mcm9tU3RyaW5nKGlucHV0KTtcbiAgICAgICAgfSxcbiAgICAgICAgZnJvbUZsb2F0NjQ6IChpbnB1dDogbnVtYmVyKTogQ29tcGxleCA9PiB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBDb21wbGV4KGlucHV0LCAwKTtcbiAgICAgICAgfSxcbiAgICAgIH0pKTtcbiAgICB9LFxuICAgIHdyaXRlPFc+KHdyaXRlcjogV3JpdGVyPFc+LCB2YWx1ZTogQ29tcGxleCk6IFcge1xuICAgICAgcmV0dXJuIHdyaXRlci53cml0ZVN0cmluZyh2YWx1ZS50b1N0cmluZygpKTtcbiAgICB9LFxuICAgIHRlc3RFcnJvcih2YWx1ZTogQ29tcGxleCk6IEVycm9yIHwgdW5kZWZpbmVkIHtcbiAgICAgIGlmICghKHZhbHVlIGluc3RhbmNlb2YgQ29tcGxleCkpIHtcbiAgICAgICAgcmV0dXJuIGNyZWF0ZUludmFsaWRUeXBlRXJyb3IoXCJDb21wbGV4XCIsIHZhbHVlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfSxcbiAgICBlcXVhbHModmFsdWUxOiBDb21wbGV4LCB2YWx1ZTI6IENvbXBsZXgpOiBib29sZWFuIHtcbiAgICAgIHJldHVybiB2YWx1ZTEucmVhbCA9PT0gdmFsdWUyLnJlYWwgJiYgdmFsdWUxLmltYWdpbmFyeSA9PT0gdmFsdWUyLmltYWdpbmFyeTtcbiAgICB9LFxuICAgIGNsb25lKHZhbHVlOiBDb21wbGV4KTogQ29tcGxleCB7XG4gICAgICByZXR1cm4gbmV3IENvbXBsZXgodmFsdWUucmVhbCwgdmFsdWUuaW1hZ2luYXJ5KTtcbiAgICB9LFxuICB9KTtcblxuICBjb25zdCBic29uU2VyaWFsaXplcjogYnNvbi5CU09OID0gbmV3IGJzb24uQlNPTigpO1xuXG4gIGNvbnN0IGl0ZW1zOiBUeXBlZFZhbHVlW10gPSBbXG4gICAge1xuICAgICAgbmFtZTogXCJDb21wbGV4IHtyZWFsOiAwLCBpbWFnaW5hcnk6IDB9XCIsXG4gICAgICB2YWx1ZTogbmV3IENvbXBsZXgoMCwgMCksXG4gICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgIG91dHB1dDoge1xuICAgICAgICBic29uOiBic29uU2VyaWFsaXplci5zZXJpYWxpemUoe186IFwiMFwifSksXG4gICAgICAgIGpzb246IFwiXFxcIjBcXFwiXCIsXG4gICAgICAgIHFzOiBcIl89MFwiLFxuICAgICAgfSxcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6IFwiQ29tcGxleCB7cmVhbDogMSwgaW1hZ2luYXJ5OiAwfVwiLFxuICAgICAgdmFsdWU6IG5ldyBDb21wbGV4KDEsIDApLFxuICAgICAgdmFsaWQ6IHRydWUsXG4gICAgICBvdXRwdXQ6IHtcbiAgICAgICAgYnNvbjogYnNvblNlcmlhbGl6ZXIuc2VyaWFsaXplKHtfOiBcIjFcIn0pLFxuICAgICAgICBqc29uOiBcIlxcXCIxXFxcIlwiLFxuICAgICAgICBxczogXCJfPTFcIixcbiAgICAgIH0sXG4gICAgfSxcbiAgICB7XG4gICAgICBuYW1lOiBcIkNvbXBsZXgge3JlYWw6IDAsIGltYWdpbmFyeTogMn1cIixcbiAgICAgIHZhbHVlOiBuZXcgQ29tcGxleCgwLCAyKSxcbiAgICAgIHZhbGlkOiB0cnVlLFxuICAgICAgb3V0cHV0OiB7XG4gICAgICAgIGJzb246IGJzb25TZXJpYWxpemVyLnNlcmlhbGl6ZSh7XzogXCIyalwifSksXG4gICAgICAgIGpzb246IFwiXFxcIjJqXFxcIlwiLFxuICAgICAgICBxczogXCJfPTJqXCIsXG4gICAgICB9LFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogXCJDb21wbGV4IHtyZWFsOiAzLCBpbWFnaW5hcnk6IDR9XCIsXG4gICAgICB2YWx1ZTogbmV3IENvbXBsZXgoMywgNCksXG4gICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgIG91dHB1dDoge1xuICAgICAgICBic29uOiBic29uU2VyaWFsaXplci5zZXJpYWxpemUoe186IFwiMyArIDRqXCJ9KSxcbiAgICAgICAganNvbjogXCJcXFwiMyArIDRqXFxcIlwiLFxuICAgICAgICBxczogXCJfPTMlMjAlMkIlMjA0alwiLFxuICAgICAgfSxcbiAgICB9LFxuICAgIHtuYW1lOiBcIlxcXCJmb29cXFwiXCIsIHZhbHVlOiBcImJhclwiLCB2YWxpZDogZmFsc2V9LFxuICAgIHtuYW1lOiBcIjBcIiwgdmFsdWU6IDAsIHZhbGlkOiBmYWxzZX0sXG4gICAge25hbWU6IFwiMVwiLCB2YWx1ZTogMSwgdmFsaWQ6IGZhbHNlfSxcbiAgICB7bmFtZTogXCJcXFwiXFxcIlwiLCB2YWx1ZTogXCJcIiwgdmFsaWQ6IGZhbHNlfSxcbiAgICB7bmFtZTogXCJcXFwiMFxcXCJcIiwgdmFsdWU6IFwiMFwiLCB2YWxpZDogZmFsc2V9LFxuICAgIHtuYW1lOiBcInRydWVcIiwgdmFsdWU6IHRydWUsIHZhbGlkOiBmYWxzZX0sXG4gICAge25hbWU6IFwiZmFsc2VcIiwgdmFsdWU6IGZhbHNlLCB2YWxpZDogZmFsc2V9LFxuICAgIHtuYW1lOiBcIkluZmluaXR5XCIsIHZhbHVlOiBJbmZpbml0eSwgdmFsaWQ6IGZhbHNlfSxcbiAgICB7bmFtZTogXCItSW5maW5pdHlcIiwgdmFsdWU6IC1JbmZpbml0eSwgdmFsaWQ6IGZhbHNlfSxcbiAgICB7bmFtZTogXCJuZXcgRGF0ZShcXFwiMTI0Ny0wNS0xOFQxOTo0MDowOC40MThaXFxcIilcIiwgdmFsdWU6IG5ldyBEYXRlKFwiMTI0Ny0wNS0xOFQxOTo0MDowOC40MThaXCIpLCB2YWxpZDogZmFsc2V9LFxuICAgIHtuYW1lOiBcIk5hTlwiLCB2YWx1ZTogTmFOLCB2YWxpZDogZmFsc2V9LFxuICAgIHtuYW1lOiBcInVuZGVmaW5lZFwiLCB2YWx1ZTogdW5kZWZpbmVkLCB2YWxpZDogZmFsc2V9LFxuICAgIHtuYW1lOiBcIm51bGxcIiwgdmFsdWU6IG51bGwsIHZhbGlkOiBmYWxzZX0sXG4gICAge25hbWU6IFwiW11cIiwgdmFsdWU6IFtdLCB2YWxpZDogZmFsc2V9LFxuICAgIHtuYW1lOiBcInt9XCIsIHZhbHVlOiB7fSwgdmFsaWQ6IGZhbHNlfSxcbiAgICB7bmFtZTogXCIvcmVnZXgvXCIsIHZhbHVlOiAvcmVnZXgvLCB2YWxpZDogZmFsc2V9LFxuICBdO1xuXG4gIHJ1blRlc3RzKGNvbXBsZXhUeXBlLCBpdGVtcyk7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
