"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const bson_1 = __importDefault(require("bson"));
const incident_1 = require("incident");
const invalid_type_1 = require("../../lib/errors/invalid-type");
const read_visitor_1 = require("../../lib/readers/read-visitor");
const custom_1 = require("../../lib/types/custom");
const test_1 = require("../helpers/test");
describe("Custom", function () {
    /**
     * Represents a complex number.
     * It only deals with complex number with small unsigned integer cartesian components for
     * simplicity.
     */
    class Complex {
        constructor(real, imaginary) {
            this.real = real;
            this.imaginary = imaginary;
            Object.freeze(this);
        }
        static fromString(input) {
            const realMatch = /^(\d+)(?:\s*\+\s*\d+j)?$/.exec(input);
            const imaginaryMatch = /^(?:\d+\s*\+\s*)?(\d+)j$/.exec(input);
            if (realMatch === null && imaginaryMatch === null) {
                throw new incident_1.Incident("InvalidInput", { input });
            }
            const real = realMatch !== null ? parseInt(realMatch[1], 10) : 0;
            const imaginary = imaginaryMatch !== null ? parseInt(imaginaryMatch[1], 10) : 0;
            return new Complex(real, imaginary);
        }
        toString() {
            const parts = [];
            if (this.real !== 0) {
                parts.push(this.real.toString(10));
            }
            if (this.imaginary !== 0) {
                parts.push(`${this.imaginary.toString(10)}j`);
            }
            // tslint:disable-next-line:strict-boolean-expressions
            return parts.join(" + ") || "0";
        }
    }
    const complexType = new custom_1.CustomType({
        read(reader, raw) {
            return reader.readString(raw, read_visitor_1.readVisitor({
                fromString: (input) => {
                    return Complex.fromString(input);
                },
                fromFloat64: (input) => {
                    return new Complex(input, 0);
                },
            }));
        },
        write(writer, value) {
            return writer.writeString(value.toString());
        },
        testError(value) {
            if (!(value instanceof Complex)) {
                return invalid_type_1.createInvalidTypeError("Complex", value);
            }
            return undefined;
        },
        equals(value1, value2) {
            return value1.real === value2.real && value1.imaginary === value2.imaginary;
        },
        clone(value) {
            return new Complex(value.real, value.imaginary);
        },
    });
    const bsonSerializer = new bson_1.default.BSON();
    const items = [
        {
            name: "Complex {real: 0, imaginary: 0}",
            value: new Complex(0, 0),
            valid: true,
            output: {
                bson: bsonSerializer.serialize({ _: "0" }),
                json: "\"0\"",
                qs: "_=0",
            },
        },
        {
            name: "Complex {real: 1, imaginary: 0}",
            value: new Complex(1, 0),
            valid: true,
            output: {
                bson: bsonSerializer.serialize({ _: "1" }),
                json: "\"1\"",
                qs: "_=1",
            },
        },
        {
            name: "Complex {real: 0, imaginary: 2}",
            value: new Complex(0, 2),
            valid: true,
            output: {
                bson: bsonSerializer.serialize({ _: "2j" }),
                json: "\"2j\"",
                qs: "_=2j",
            },
        },
        {
            name: "Complex {real: 3, imaginary: 4}",
            value: new Complex(3, 4),
            valid: true,
            output: {
                bson: bsonSerializer.serialize({ _: "3 + 4j" }),
                json: "\"3 + 4j\"",
                qs: "_=3%20%2B%204j",
            },
        },
        { name: "\"foo\"", value: "bar", valid: false },
        { name: "0", value: 0, valid: false },
        { name: "1", value: 1, valid: false },
        { name: "\"\"", value: "", valid: false },
        { name: "\"0\"", value: "0", valid: false },
        { name: "true", value: true, valid: false },
        { name: "false", value: false, valid: false },
        { name: "Infinity", value: Infinity, valid: false },
        { name: "-Infinity", value: -Infinity, valid: false },
        { name: "new Date(\"1247-05-18T19:40:08.418Z\")", value: new Date("1247-05-18T19:40:08.418Z"), valid: false },
        { name: "NaN", value: NaN, valid: false },
        { name: "undefined", value: undefined, valid: false },
        { name: "null", value: null, valid: false },
        { name: "[]", value: [], valid: false },
        { name: "{}", value: {}, valid: false },
        { name: "/regex/", value: /regex/, valid: false },
    ];
    test_1.runTests(complexType, items);
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90ZXN0L3R5cGVzL2N1c3RvbS5zcGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsZ0RBQXdCO0FBQ3hCLHVDQUFvQztBQUVwQyxnRUFBdUU7QUFDdkUsaUVBQTZEO0FBQzdELG1EQUFvRDtBQUNwRCwwQ0FBdUQ7QUFFdkQsUUFBUSxDQUFDLFFBQVEsRUFBRTtJQUNqQjs7OztPQUlHO0lBQ0gsTUFBTSxPQUFPO1FBSVgsWUFBWSxJQUFZLEVBQUUsU0FBaUI7WUFDekMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7WUFDakIsSUFBSSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7WUFDM0IsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN0QixDQUFDO1FBRUQsTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFhO1lBQzdCLE1BQU0sU0FBUyxHQUEyQiwwQkFBMEIsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDakYsTUFBTSxjQUFjLEdBQTJCLDBCQUEwQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUN0RixJQUFJLFNBQVMsS0FBSyxJQUFJLElBQUksY0FBYyxLQUFLLElBQUksRUFBRTtnQkFDakQsTUFBTSxJQUFJLG1CQUFRLENBQUMsY0FBYyxFQUFFLEVBQUMsS0FBSyxFQUFDLENBQUMsQ0FBQzthQUM3QztZQUNELE1BQU0sSUFBSSxHQUFXLFNBQVMsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN6RSxNQUFNLFNBQVMsR0FBVyxjQUFjLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDeEYsT0FBTyxJQUFJLE9B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S0FBSyxFQUFDO1FBQ3pDLEVBQUMsSUFBSSxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUM7UUFDM0MsRUFBQyxJQUFJLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBQztRQUNqRCxFQUFDLElBQUksRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLENBQUMsUUFBUSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUM7UUFDbkQsRUFBQyxJQUFJLEVBQUUsd0NBQXdDLEVBQUUsS0FBSyxFQUFFLElBQUksSUFBSSxDQUFDLDBCQUEwQixDQUFDLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBQztRQUMzRyxFQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFDO1FBQ3ZDLEVBQUMsSUFBSSxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUM7UUFDbkQsRUFBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBQztRQUN6QyxFQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFDO1FBQ3JDLEVBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUM7UUFDckMsRUFBQyxJQUFJLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBQztLQUNoRCxDQUFDO0lBRUYsZUFBUSxDQUFDLFdBQVcsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUMvQixDQUFDLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L3R5cGVzL2N1c3RvbS5zcGVjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGJzb24gZnJvbSBcImJzb25cIjtcbmltcG9ydCB7IEluY2lkZW50IH0gZnJvbSBcImluY2lkZW50XCI7XG5pbXBvcnQgeyBSZWFkZXIsIFdyaXRlciB9IGZyb20gXCIuLi8uLi9saWIvY29yZVwiO1xuaW1wb3J0IHsgY3JlYXRlSW52YWxpZFR5cGVFcnJvciB9IGZyb20gXCIuLi8uLi9saWIvZXJyb3JzL2ludmFsaWQtdHlwZVwiO1xuaW1wb3J0IHsgcmVhZFZpc2l0b3IgfSBmcm9tIFwiLi4vLi4vbGliL3JlYWRlcnMvcmVhZC12aXNpdG9yXCI7XG5pbXBvcnQgeyBDdXN0b21UeXBlIH0gZnJvbSBcIi4uLy4uL2xpYi90eXBlcy9jdXN0b21cIjtcbmltcG9ydCB7IHJ1blRlc3RzLCBUeXBlZFZhbHVlIH0gZnJvbSBcIi4uL2hlbHBlcnMvdGVzdFwiO1xuXG5kZXNjcmliZShcIkN1c3RvbVwiLCBmdW5jdGlvbiAoKSB7XG4gIC8qKlxuICAgKiBSZXByZXNlbnRzIGEgY29tcGxleCBudW1iZXIuXG4gICAqIEl0IG9ubHkgZGVhbHMgd2l0aCBjb21wbGV4IG51bWJlciB3aXRoIHNtYWxsIHVuc2lnbmVkIGludGVnZXIgY2FydGVzaWFuIGNvbXBvbmVudHMgZm9yXG4gICAqIHNpbXBsaWNpdHkuXG4gICAqL1xuICBjbGFzcyBDb21wbGV4IHtcbiAgICByZWFkb25seSByZWFsOiBudW1iZXI7XG4gICAgcmVhZG9ubHkgaW1hZ2luYXJ5OiBudW1iZXI7XG5cbiAgICBjb25zdHJ1Y3RvcihyZWFsOiBudW1iZXIsIGltYWdpbmFyeTogbnVtYmVyKSB7XG4gICAgICB0aGlzLnJlYWwgPSByZWFsO1xuICAgICAgdGhpcy5pbWFnaW5hcnkgPSBpbWFnaW5hcnk7XG4gICAgICBPYmplY3QuZnJlZXplKHRoaXMpO1xuICAgIH1cblxuICAgIHN0YXRpYyBmcm9tU3RyaW5nKGlucHV0OiBzdHJpbmcpOiBDb21wbGV4IHtcbiAgICAgIGNvbnN0IHJlYWxNYXRjaDogUmVnRXhwRXhlY0FycmF5IHwgbnVsbCA9IC9eKFxcZCspKD86XFxzKlxcK1xccypcXGQraik/JC8uZXhlYyhpbnB1dCk7XG4gICAgICBjb25zdCBpbWFnaW5hcnlNYXRjaDogUmVnRXhwRXhlY0FycmF5IHwgbnVsbCA9IC9eKD86XFxkK1xccypcXCtcXHMqKT8oXFxkKylqJC8uZXhlYyhpbnB1dCk7XG4gICAgICBpZiAocmVhbE1hdGNoID09PSBudWxsICYmIGltYWdpbmFyeU1hdGNoID09PSBudWxsKSB7XG4gICAgICAgIHRocm93IG5ldyBJbmNpZGVudChcIkludmFsaWRJbnB1dFwiLCB7aW5wdXR9KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHJlYWw6IG51bWJlciA9IHJlYWxNYXRjaCAhPT0gbnVsbCA/IHBhcnNlSW50KHJlYWxNYXRjaFsxXSwgMTApIDogMDtcbiAgICAgIGNvbnN0IGltYWdpbmFyeTogbnVtYmVyID0gaW1hZ2luYXJ5TWF0Y2ggIT09IG51bGwgPyBwYXJzZUludChpbWFnaW5hcnlNYXRjaFsxXSwgMTApIDogMDtcbiAgICAgIHJldHVybiBuZXcgQ29tcGxleChyZWFsLCBpbWFnaW5hcnkpO1xuICAgIH1cblxuICAgIHRvU3RyaW5nKCk6IHN0cmluZyB7XG4gICAgICBjb25zdCBwYXJ0czogc3RyaW5nW10gPSBbXTtcbiAgICAgIGlmICh0aGlzLnJlYWwgIT09IDApIHtcbiAgICAgICAgcGFydHMucHVzaCh0aGlzLnJlYWwudG9TdHJpbmcoMTApKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmltYWdpbmFyeSAhPT0gMCkge1xuICAgICAgICBwYXJ0cy5wdXNoKGAke3RoaXMuaW1hZ2luYXJ5LnRvU3RyaW5nKDEwKX1qYCk7XG4gICAgICB9XG4gICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6c3RyaWN0LWJvb2xlYW4tZXhwcmVzc2lvbnNcbiAgICAgIHJldHVybiBwYXJ0cy5qb2luKFwiICsgXCIpIHx8IFwiMFwiO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGNvbXBsZXhUeXBlOiBDdXN0b21UeXBlPENvbXBsZXg+ID0gbmV3IEN1c3RvbVR5cGUoe1xuICAgIHJlYWQ8Uj4ocmVhZGVyOiBSZWFkZXI8Uj4sIHJhdzogUik6IENvbXBsZXgge1xuICAgICAgcmV0dXJuIHJlYWRlci5yZWFkU3RyaW5nKHJhdywgcmVhZFZpc2l0b3Ioe1xuICAgICAgICBmcm9tU3RyaW5nOiAoaW5wdXQ6IHN0cmluZyk6IENvbXBsZXggPT4ge1xuICAgICAgICAgIHJldHVybiBDb21wbGV4LmZyb21TdHJpbmcoaW5wdXQpO1xuICAgICAgICB9LFxuICAgICAgICBmcm9tRmxvYXQ2NDogKGlucHV0OiBudW1iZXIpOiBDb21wbGV4ID0+IHtcbiAgICAgICAgICByZXR1cm4gbmV3IENvbXBsZXgoaW5wdXQsIDApO1xuICAgICAgICB9LFxuICAgICAgfSkpO1xuICAgIH0sXG4gICAgd3JpdGU8Vz4od3JpdGVyOiBXcml0ZXI8Vz4sIHZhbHVlOiBDb21wbGV4KTogVyB7XG4gICAgICByZXR1cm4gd3JpdGVyLndyaXRlU3RyaW5nKHZhbHVlLnRvU3RyaW5nKCkpO1xuICAgIH0sXG4gICAgdGVzdEVycm9yKHZhbHVlOiBDb21wbGV4KTogRXJyb3IgfCB1bmRlZmluZWQge1xuICAgICAgaWYgKCEodmFsdWUgaW5zdGFuY2VvZiBDb21wbGV4KSkge1xuICAgICAgICByZXR1cm4gY3JlYXRlSW52YWxpZFR5cGVFcnJvcihcIkNvbXBsZXhcIiwgdmFsdWUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9LFxuICAgIGVxdWFscyh2YWx1ZTE6IENvbXBsZXgsIHZhbHVlMjogQ29tcGxleCk6IGJvb2xlYW4ge1xuICAgICAgcmV0dXJuIHZhbHVlMS5yZWFsID09PSB2YWx1ZTIucmVhbCAmJiB2YWx1ZTEuaW1hZ2luYXJ5ID09PSB2YWx1ZTIuaW1hZ2luYXJ5O1xuICAgIH0sXG4gICAgY2xvbmUodmFsdWU6IENvbXBsZXgpOiBDb21wbGV4IHtcbiAgICAgIHJldHVybiBuZXcgQ29tcGxleCh2YWx1ZS5yZWFsLCB2YWx1ZS5pbWFnaW5hcnkpO1xuICAgIH0sXG4gIH0pO1xuXG4gIGNvbnN0IGJzb25TZXJpYWxpemVyOiBic29uLkJTT04gPSBuZXcgYnNvbi5CU09OKCk7XG5cbiAgY29uc3QgaXRlbXM6IFR5cGVkVmFsdWVbXSA9IFtcbiAgICB7XG4gICAgICBuYW1lOiBcIkNvbXBsZXgge3JlYWw6IDAsIGltYWdpbmFyeTogMH1cIixcbiAgICAgIHZhbHVlOiBuZXcgQ29tcGxleCgwLCAwKSxcbiAgICAgIHZhbGlkOiB0cnVlLFxuICAgICAgb3V0cHV0OiB7XG4gICAgICAgIGJzb246IGJzb25TZXJpYWxpemVyLnNlcmlhbGl6ZSh7XzogXCIwXCJ9KSxcbiAgICAgICAganNvbjogXCJcXFwiMFxcXCJcIixcbiAgICAgICAgcXM6IFwiXz0wXCIsXG4gICAgICB9LFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogXCJDb21wbGV4IHtyZWFsOiAxLCBpbWFnaW5hcnk6IDB9XCIsXG4gICAgICB2YWx1ZTogbmV3IENvbXBsZXgoMSwgMCksXG4gICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgIG91dHB1dDoge1xuICAgICAgICBic29uOiBic29uU2VyaWFsaXplci5zZXJpYWxpemUoe186IFwiMVwifSksXG4gICAgICAgIGpzb246IFwiXFxcIjFcXFwiXCIsXG4gICAgICAgIHFzOiBcIl89MVwiLFxuICAgICAgfSxcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6IFwiQ29tcGxleCB7cmVhbDogMCwgaW1hZ2luYXJ5OiAyfVwiLFxuICAgICAgdmFsdWU6IG5ldyBDb21wbGV4KDAsIDIpLFxuICAgICAgdmFsaWQ6IHRydWUsXG4gICAgICBvdXRwdXQ6IHtcbiAgICAgICAgYnNvbjogYnNvblNlcmlhbGl6ZXIuc2VyaWFsaXplKHtfOiBcIjJqXCJ9KSxcbiAgICAgICAganNvbjogXCJcXFwiMmpcXFwiXCIsXG4gICAgICAgIHFzOiBcIl89MmpcIixcbiAgICAgIH0sXG4gICAgfSxcbiAgICB7XG4gICAgICBuYW1lOiBcIkNvbXBsZXgge3JlYWw6IDMsIGltYWdpbmFyeTogNH1cIixcbiAgICAgIHZhbHVlOiBuZXcgQ29tcGxleCgzLCA0KSxcbiAgICAgIHZhbGlkOiB0cnVlLFxuICAgICAgb3V0cHV0OiB7XG4gICAgICAgIGJzb246IGJzb25TZXJpYWxpemVyLnNlcmlhbGl6ZSh7XzogXCIzICsgNGpcIn0pLFxuICAgICAgICBqc29uOiBcIlxcXCIzICsgNGpcXFwiXCIsXG4gICAgICAgIHFzOiBcIl89MyUyMCUyQiUyMDRqXCIsXG4gICAgICB9LFxuICAgIH0sXG4gICAge25hbWU6IFwiXFxcImZvb1xcXCJcIiwgdmFsdWU6IFwiYmFyXCIsIHZhbGlkOiBmYWxzZX0sXG4gICAge25hbWU6IFwiMFwiLCB2YWx1ZTogMCwgdmFsaWQ6IGZhbHNlfSxcbiAgICB7bmFtZTogXCIxXCIsIHZhbHVlOiAxLCB2YWxpZDogZmFsc2V9LFxuICAgIHtuYW1lOiBcIlxcXCJcXFwiXCIsIHZhbHVlOiBcIlwiLCB2YWxpZDogZmFsc2V9LFxuICAgIHtuYW1lOiBcIlxcXCIwXFxcIlwiLCB2YWx1ZTogXCIwXCIsIHZhbGlkOiBmYWxzZX0sXG4gICAge25hbWU6IFwidHJ1ZVwiLCB2YWx1ZTogdHJ1ZSwgdmFsaWQ6IGZhbHNlfSxcbiAgICB7bmFtZTogXCJmYWxzZVwiLCB2YWx1ZTogZmFsc2UsIHZhbGlkOiBmYWxzZX0sXG4gICAge25hbWU6IFwiSW5maW5pdHlcIiwgdmFsdWU6IEluZmluaXR5LCB2YWxpZDogZmFsc2V9LFxuICAgIHtuYW1lOiBcIi1JbmZpbml0eVwiLCB2YWx1ZTogLUluZmluaXR5LCB2YWxpZDogZmFsc2V9LFxuICAgIHtuYW1lOiBcIm5ldyBEYXRlKFxcXCIxMjQ3LTA1LTE4VDE5OjQwOjA4LjQxOFpcXFwiKVwiLCB2YWx1ZTogbmV3IERhdGUoXCIxMjQ3LTA1LTE4VDE5OjQwOjA4LjQxOFpcIiksIHZhbGlkOiBmYWxzZX0sXG4gICAge25hbWU6IFwiTmFOXCIsIHZhbHVlOiBOYU4sIHZhbGlkOiBmYWxzZX0sXG4gICAge25hbWU6IFwidW5kZWZpbmVkXCIsIHZhbHVlOiB1bmRlZmluZWQsIHZhbGlkOiBmYWxzZX0sXG4gICAge25hbWU6IFwibnVsbFwiLCB2YWx1ZTogbnVsbCwgdmFsaWQ6IGZhbHNlfSxcbiAgICB7bmFtZTogXCJbXVwiLCB2YWx1ZTogW10sIHZhbGlkOiBmYWxzZX0sXG4gICAge25hbWU6IFwie31cIiwgdmFsdWU6IHt9LCB2YWxpZDogZmFsc2V9LFxuICAgIHtuYW1lOiBcIi9yZWdleC9cIiwgdmFsdWU6IC9yZWdleC8sIHZhbGlkOiBmYWxzZX0sXG4gIF07XG5cbiAgcnVuVGVzdHMoY29tcGxleFR5cGUsIGl0ZW1zKTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLiJ9
